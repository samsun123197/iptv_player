<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>‚ö°‚ú®BarBar‚ú®‚ö° IPTV PLAYER</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body { margin:0; font-family:'Segoe UI',sans-serif; background:#0f0f1a; color:#eee; transition:0.3s; }
    body.light { background:#f0f0f0; color:#111; }
    header { padding:20px; text-align:center; font-size:26px; font-weight:bold; background:linear-gradient(90deg,#ffcc00,#ff9900); color:#000; box-shadow:0 4px 6px rgba(0,0,0,0.3); }
    .auth, .m3u-input { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-top:10px; }
    .auth input, .auth button, .m3u-input input, .m3u-input button { padding:12px; font-size:16px; border-radius:8px; border:none; }
    .auth input, .m3u-input input { width:200px; }
    .auth button, .m3u-input button { background:#ffcc00; color:#000; cursor:pointer; font-weight:bold; transition:0.2s; }
    .auth button:hover, .m3u-input button:hover { background:#ff9900; }
    .search-filter { display:flex; justify-content:center; flex-wrap:wrap; gap:10px; margin:15px 0; }
    .search-filter input, .search-filter select, .search-filter button { padding:10px; border-radius:6px; border:none; font-size:16px; }
    .search-filter button { background:#ffcc00; color:#000; cursor:pointer; font-weight:bold; transition:0.2s; }
    .search-filter button:hover { background:#ff9900; }
    .controls { display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin:20px 0; }
    .controls button { padding:10px 15px; border-radius:8px; border:none; background:#ffcc00; color:#000; font-weight:bold; cursor:pointer; transition:0.2s; }
    .controls button:hover { background:#ff9900; }
    .container { padding:20px; }
    .channel-card { position:relative; background:#1a1a2e; width:200px; border-radius:12px; overflow:hidden; cursor:pointer; transition:0.3s; box-shadow:0 4px 8px rgba(0,0,0,0.5); }
    .channel-card:hover { transform:translateY(-5px); box-shadow:0 8px 16px rgba(0,0,0,0.6); }
    .channel-card img { width:100%; height:70px; object-fit:cover; }
    .channel-card h3 { margin:10px; font-size:14px; text-align:center; }
    .favorite-btn { position:absolute; top:8px; right:8px; background:#ffcc00; color:#000; border:none; border-radius:50%; width:30px; height:30px; cursor:pointer; font-weight:bold; }
    video { width:100%; max-width:720px; display:block; margin:20px auto; border-radius:12px; border:2px solid #ffcc00; }
    footer { text-align:center; padding:10px; font-size:14px; color:#888; }
    @media(max-width:768px){.channel-card{width:45%;}}
    @media(max-width:480px){.channel-card{width:90%;}}
  </style>
</head>
<body onload="loadCredentials(); loadFavorites();">

<header>‚ö°‚ú®BarBar‚ú®‚ö° IPTV PLAYER</header>

<div class="m3u-input">
  <input type="text" id="m3uLink" placeholder="M3U Baƒülantƒ±sƒ± (Xtream format)">
  <button onclick="parseXtreamM3ULink()">üîó Ayƒ±r ve Doldur</button>
</div>

<div class="auth">
  <input type="text" id="server" placeholder="Sunucu">
  <input type="text" id="username" placeholder="Kullanƒ±cƒ± Adƒ±">
  <input type="password" id="password" placeholder="≈ûifre">
  <button onclick="initialize()">Giri≈ü Yap</button>
  <button onclick="toggleTheme()">üåó Tema</button>
</div>

<div class="search-filter">
  <input type="text" id="searchInput" placeholder="Kanal Ara">
  <button onclick="filterChannels()">üîç Ara</button>
  <select id="categorySelect" onchange="filterChannels()">
    <option value="">T√ºm Kategoriler</option>
  </select>
</div>

<video id="video" controls></video>
<div class="controls">
  <button onclick="rewind()">‚è™ 10sn Geri</button>
  <button onclick="forward()">‚è© 10sn ƒ∞leri</button>
</div>

<div class="container" id="channelGrid"></div>

<footer>‚ö°‚ú®BarBar‚ú®‚ö° Modern IPTV Panel</footer>

<script>
let server='', username='', password='', channels=[], filteredChannels=[], currentIndex=-1;
let favorites = [];

function saveCredentials() {
  localStorage.setItem('iptv_server', server);
  localStorage.setItem('iptv_user', username);
  localStorage.setItem('iptv_pass', password);
}
function loadCredentials() {
  server = localStorage.getItem('iptv_server')||'';
  username = localStorage.getItem('iptv_user')||'';
  password = localStorage.getItem('iptv_pass')||'';
  document.getElementById('server').value=server;
  document.getElementById('username').value=username;
  document.getElementById('password').value=password;
  if(server && username && password) initialize();
}
function loadFavorites(){
  favorites = JSON.parse(localStorage.getItem('favorites'))||[];
}
function parseXtreamM3ULink(){
  const link = document.getElementById('m3uLink').value.trim();
  try {
    const url = new URL(link);
    const server = `${url.protocol}//${url.host}`;
    const params = new URLSearchParams(url.search);
    const username = params.get('username');
    const password = params.get('password');
    if (!username || !password) throw "Kullanƒ±cƒ± adƒ± veya ≈üifre bulunamadƒ±.";
    document.getElementById('server').value = server;
    document.getElementById('username').value = username;
    document.getElementById('password').value = password;
    alert("Bilgiler ayrƒ±ldƒ± ve kutulara yerle≈ütirildi ‚úÖ");
  } catch (err) {
    alert("Baƒülantƒ± √ß√∂z√ºmlenemedi: " + err);
  }
}
function initialize(){
  server = document.getElementById('server').value.trim();
  username = document.getElementById('username').value.trim();
  password = document.getElementById('password').value.trim();
  if(!server||!username||!password) return alert("T√ºm alanlarƒ± doldurun.");
  saveCredentials();
  loadChannels();
}
async function loadChannels(){
  try{
    let url=`${server}/player_api.php?username=${username}&password=${password}&action=get_live_streams`;
    const res = await fetch(url);
    const data = await res.json();
    if(!Array.isArray(data)) throw "Kanallar alƒ±namadƒ± veya JSON formatƒ± bilinmiyor!";
    channels = data;
    filteredChannels = channels;
    populateCategories();
    renderChannels();
  }catch(err){
    alert("Kanallar alƒ±namadƒ±! Hata: "+err);
    console.error(err);
  }
}
function populateCategories(){
  const catSelect=document.getElementById('categorySelect');
  catSelect.innerHTML='<option value="">T√ºm Kategoriler</option>';
  const cats=[...new Set(channels.map(c=>c.category_name))];
  cats.forEach(cat=>{
    const opt=document.createElement('option');
    opt.value=cat; opt.textContent=cat;
    catSelect.appendChild(opt);
  });
}
function renderChannels(){
  const grid=document.getElementById('channelGrid');
  grid.innerHTML='';
  const categories = [...new Set(filteredChannels.map(c => c.category_name))];
  categories.forEach(cat => {
    const catTitle = document.createElement('h2');
    catTitle.textContent = cat;
    catTitle.style = "width:100%; text-align:left; color:#ffcc00; margin-top:30px; font-size:20px;";
    grid.appendChild(catTitle);
    const catGroup = document.createElement('div');
    catGroup.style = "display:flex; flex-wrap:wrap; gap:15px;";
    filteredChannels.filter(c => c.category_name === cat).forEach((ch, index) => {
      const div = document.createElement('div');
      div.className = 'channel-card';
      div.innerHTML = `<img src="${ch.stream_icon||''}" /><h3>${ch.name||ch.stream_name||"Unnamed"}</h3>`;

      const favBtn = document.createElement('button');
      favBtn.className = 'favorite-btn';
      favBtn.innerHTML = '‚≠ê';
      favBtn.onclick = (e) => {
        e.stopPropagation();
        addToFavorites(ch);
      };
      div.appendChild(favBtn);

      div.onclick = () => {
        currentIndex = index;
        playChannel(ch);
        document.getElementById('video').scrollIntoView({behavior:'smooth'});
      };

      catGroup.appendChild(div);
    });

    grid.appendChild(catGroup);
  });
}

function filterChannels(){
  const search=document.getElementById('searchInput').value.toLowerCase();
  const cat=document.getElementById('categorySelect').value;
  filteredChannels=channels.filter(ch=>{
    return (!cat || ch.category_name===cat) &&
           (ch.name.toLowerCase().includes(search) || (ch.stream_name && ch.stream_name.toLowerCase().includes(search)));
  });
  renderChannels();
}

function addToFavorites(ch){
  if(!favorites.some(f=>f.stream_id===ch.stream_id)) favorites.push(ch);
  localStorage.setItem('favorites', JSON.stringify(favorites));
  alert(ch.name + " favorilere eklendi!");
}

function playChannel(ch){
  const video=document.getElementById('video');
  const url=ch.stream_url||(ch.stream_id?`${server}/live/${username}/${password}/${ch.stream_id}.m3u8`:"");
  if(!url){ alert("Oynatƒ±lacak URL bulunamadƒ±!"); return; }

  if(Hls.isSupported()){
    const hls=new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
  } else if(video.canPlayType('application/vnd.apple.mpegurl')){
    video.src=url; video.play();
  } else alert("Tarayƒ±cƒ± HLS desteklemiyor!");
}

function rewind(){ document.getElementById('video').currentTime-=10; }
function forward(){ document.getElementById('video').currentTime+=10; }
function toggleTheme(){ document.body.classList.toggle('light'); }
</script>
</body>
</html>